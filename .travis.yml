branches:
  only:
    - master
    - dev
os:
  - linux
language: node_js
node_js:
  - 12
cache:
  directories:
    - node_modules
install:
  - npm install

script:
  - if [[ ${BUNDLE_ANALYZER_TOKEN} != "" ]]; then npm install --no-save @bundle-analyzer/webpack-plugin; fi
  - npm run build
  - npm test

before_deploy:
  - export TRAVIS_TAG=$(node -p "require('./package.json').version")
  - echo ${TRAVIS_TAG}
  - 'if [[ ${TAGGED} != 1 ]]; then export PACKAGE=$(npm pack --silent) && git tag ${TRAVIS_TAG} && export TAGGED=1; fi'
deploy:
  - provider: releases
    skip_cleanup: true
    file: $PACKAGE
    api_key:
      secure: iXcRgSgyD4aqe9jAGFxKlXworkDNummooQ9n+6KFLXeafsZRvx7wezPSxjtEuVLWVlbdZrkbvzq6zQRlN2OV9M1ONRCtmZvh9HvrEL3bDqWpUbM2Pk7iSSyjXQZzZll+3pSizgcELPF/WVSADPwkXd9qLWeU1pTRyYeckRuti1gQUxOxDEch3xqdycFkATEr+bDFDE9W5Z/jXpHqiouwBMLzB14o/BJzoJ7FF7c4L4dka7g+VP8UI4+CCI47qcJv09Klko4G782qRmJ7/vT+xOo/JEuDH7QJ4Su5R7IfmRiLs3LktnebYmXw0+IqAxY8hsbxnchFSx2pkS0WcRXPeIt5r9Y63wN8UVuPou57pqBVGzyw2rnKy1VEkb1QHbwvrJL8Tr5AbXKSLYlmel6xANRMOv0wRfvHlxLxKiK45NJZCgQCVNBkBKh/f9qrU+R5ZTt1DrmMR1B5O3O7hSkxCJBHXNSpTPr0Kkg6BJSYdjju+9KS/6vxvHc3n9y4mpv8iHlocqDFDgPVml1+CqNRWZ2tj/mA1GdLd1xmvjq+pdNdE6bgXlKhUqhS9/TSO1qwFYyYorQ7cVjrFDoHNM5zt9HDH7B+kv1Rhq8CU+v2PKXLMlkR+jKfhBO2Zfj1ous6s0fSNHK7L0+c3Kn7+nnh7TxrKTixKJZIlxrDbLXPM0k=
    on:
      repo: eidng8/xml-patch-cli
      branch: master
      condition: ${TRAVIS_EVENT_TYPE} == push
  - provider: npm
    skip_cleanup: true
    email: cheung.jackey@gmail.com
    api_key:
      secure: eFibazb8D+S5Aafdiy7VS7198KeZl55muMvgyRZ9x1WjPVjijTMQZvghgIQZYv7HTksYbjtlHaHHJawQW6zn1sj1qHagWqIjMPFt6pv/knyuL8Kk9gHNF+iS7S1gjiS62ONhdoG+5xNG8z5PzKra9oRHNvGMgjM0iM902wFZDe7n8hfY+K7StYShZmlN6ABEhE5OugZ1Y6MaFeD6A4xqZ2Yk2UtG/sCM4kuMWyBHVCc2DuVVLX1U3QBAZ0J2PYbmHuZzlPOAM/wGvrPP3dpD7jYG/iZ3PuyHQrMPXU7Zf9MaPg48C5SYzxCZgeyZ9CPOfhMW/OEi5ZizCo5kJWzW+xxS/skeFgiL09lNP+luGn+WSz0P8jnU5+u8bHQkdWYR2eTNxiwXghL1Rl42luEG60HyC/mYg88bovFgct7FnqpSFfaWw+HT6VPjz2ePKk6JJLkVy4arHdzeVGnCkOulnFgqkVrc+G8g3h3d98D2gdErFluRe0qUws3Wm06wzZWWCl9IBdk5pVhNX6xbhpacHmqYqKvqE5EE88wE2XnQf6HV7mowgIXnWGNE36S9kik1rg3E8ro3kmOfFYG1li7/h5SGUM9+kmEJi7WuU/m3zMK+Lk9wW5UDd0LJ+pD9WiEEVVaTtZlLT/HzMtC0O0hFH61vFK0cMUaa6dGO8PREiYE=
    on:
      repo: eidng8/xml-patch-cli
      branch: master
      condition: ${TRAVIS_EVENT_TYPE} == push
